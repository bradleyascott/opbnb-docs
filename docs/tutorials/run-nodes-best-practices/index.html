<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorials/run-nodes-best-practices">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Best Practices for opBNB Node Configuration | BNB Optimistic Rollup</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.bnbchain.org/opbnb-docs/docs/tutorials/run-nodes-best-practices/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Best Practices for opBNB Node Configuration | BNB Optimistic Rollup"><meta data-rh="true" name="description" content="Comprehensive Manual for Operating an opBNB Node Utilizing Best Practices"><meta data-rh="true" property="og:description" content="Comprehensive Manual for Operating an opBNB Node Utilizing Best Practices"><link data-rh="true" rel="icon" href="/opbnb-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.bnbchain.org/opbnb-docs/docs/tutorials/run-nodes-best-practices/"><link data-rh="true" rel="alternate" href="https://docs.bnbchain.org/opbnb-docs/docs/tutorials/run-nodes-best-practices/" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.bnbchain.org/opbnb-docs/docs/tutorials/run-nodes-best-practices/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://3LF005YNGZ-dsn.algolia.net" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LSRFL0KHRR"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LSRFL0KHRR",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="BNB Optimistic Rollup" href="/opbnb-docs/opensearch.xml"><link rel="stylesheet" href="/opbnb-docs/assets/css/styles.3e49918d.css">
<link rel="preload" href="/opbnb-docs/assets/js/runtime~main.0eccf838.js" as="script">
<link rel="preload" href="/opbnb-docs/assets/js/main.1bd97818.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/opbnb-docs/"><div class="navbar__logo"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--light_HNdA"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">BNB Optimistic Rollup</b></a><a class="navbar__item navbar__link" link="[object Object]" href="/opbnb-docs/docs/build-on-opbnb/getting-started/">Getting Started</a><a class="navbar__item navbar__link" link="[object Object]" href="/opbnb-docs/docs/core-concepts/need-for-opbnb/">Core Concepts</a><a class="navbar__item navbar__link" link="[object Object]" href="/opbnb-docs/docs/tutorials/running-a-local-node/">Tutorials</a><a class="navbar__item navbar__link" link="[object Object]" href="/opbnb-docs/docs/faq/opbnb-faq/">FAQs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/bnb-chain/opbnb-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/opbnb-docs/docs/tutorials/running-a-local-development-environment/">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opbnb-docs/docs/tutorials/running-a-local-development-environment/">Run Local Dev Environment</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/opbnb-docs/docs/tutorials/run-nodes-best-practices/">Run opBNB Nodes</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/opbnb-docs/docs/tutorials/run-nodes-best-practices/">Best Practices for opBNB Node Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opbnb-docs/docs/tutorials/running-a-local-node/">Run Local Mainnet or Testnet Node</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opbnb-docs/docs/tutorials/pbss-pebble/">Run with PBSS and PebbleDB</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opbnb-docs/docs/tutorials/full-stack-dapp/">Create a Full Stack dapp</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/opbnb-docs/docs/tutorials/opbnbscan-verify-hardhat-truffle/">Verify Smart Contracts with Hardhat and Truffle</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_BDYx"><div class="docItemContainer_oq1c"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/opbnb-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tutorials</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Run opBNB Nodes</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Best Practices for opBNB Node Configuration</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12"><h1>Best Practices for opBNB Node Configuration</h1><p>This manual delineates Best practices for the configuration and operation of an opBNB Node.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="selecting-the-appropriate-mode-and-storage-scheme">Selecting the Appropriate Mode and Storage Scheme<a class="hash-link" href="#selecting-the-appropriate-mode-and-storage-scheme" title="Direct link to heading">​</a></h2><p>opBNB accommodates various node modes: Full, Fast, and Archive.
Two storage schemes are available: HBSS (Hash-Based Scheme Storage) and PBSS (Path-Based Scheme Storage).</p><p>The principal distinctions between them lie in their methods of preserving history trie data.</p><p>The Merkle Patricia Trie (MPT), an advanced data structure, is adept at storing and retrieving key-value pairs with efficiency. It amalgamates the principles of a Patricia trie and a Merkle tree to forge a secure and immutable representation of data within the Ethereum Virtual Machine (EVM).</p><p>The MPT endows the following capabilities:</p><ul><li>Access to historical data: Enables retrieval of an account&#x27;s balance at a specified block height, simulation of calls, and debugging of traces at particular block heights, among others.</li><li>Verification of Inclusion and Exclusion:
The MPT facilitates proofs of both inclusion and exclusion of key-value pairs, a pivotal feature for transaction verification and blockchain integrity maintenance.</li></ul><p>Nevertheless, the preservation of entire history trie data on disk can demand substantial resources and may be superfluous for certain applications. opBNB introduces diverse node modes and storage schemes to accommodate a range of requirements.</p><p>The variances between the modes and storage schemes are encapsulated as follows:</p><ul><li>Archive node mode conserves the complete history trie data. Full node mode archives recent trie data (128 blocks), whereas the fast node mode retains only the current state, excluding trie data.<ul><li>Functions such as block, transaction, receipt, and log retrieval are supported across all node modes. Since block data is preserved in the block database, it remains unaffected by the trie data storage scheme.</li><li>The capability to access historical state data varies by node mode. Archive nodes support comprehensive historical state data retrieval, whereas full and fast nodes facilitate access to recent 128 blocks&#x27; state data.</li><li>Trie data-dependent functions like <code>eth_getProof</code>, <code>eth_getStorageAt</code>, etc., are fully supported by Archive nodes. Full nodes offer queries for recent 128 blocks, whereas fast nodes lack this support.</li><li>Specifically, given that the transfer from Layer 2 to Layer 1 necessitates <code>eth_getProof</code> data corresponding to the most recent root hash height, we have implemented certain enhancements within the full node configuration to facilitate <code>eth_getProof</code> for the latest root hash height, irrespective of it surpassing the 128-block threshold. Should you require the utilization of your personal node for the assembly of withdrawal proof, the full node mode is at your disposal.</li></ul></li><li>PBSS archives trie nodes on disk utilizing encoded paths and specific key prefixes as keys. This method permits PBSS&#x27;s Merkle Patricia Trie (MPT) to supersede older data due to the shared key between the account trie and storage trie, enabling <strong>online pruning</strong> and significantly <strong>diminishing data redundancy</strong>.<ul><li>Archive node mode is only compatible with HBSS, whereas Full and Fast node modes support both HBSS and PBSS.</li><li>For further details, please consult the <a href="/opbnb-docs/docs/tutorials/pbss-pebble/">PBSS document</a>.</li></ul></li></ul><p>Comparative Analysis of Node Modes and Storage Schemes:</p><table><thead><tr><th><strong>Mode</strong></th><th><strong>Full Node (PBSS)</strong></th><th><strong>Full Node (HBSS)</strong></th><th><strong>Fast Node</strong></th><th><strong>Archive Node</strong></th></tr></thead><tbody><tr><td><strong>Preserve Trie Nodes</strong></td><td>Latest 128 blocks</td><td>Latest 128 blocks</td><td>None</td><td>All</td></tr><tr><td><strong>Disk Consumption</strong></td><td>Moderate-Low</td><td>Moderate-High</td><td>Lowest</td><td>Highest</td></tr><tr><td><strong>Auto Prune History Trie Data</strong></td><td>Yes</td><td>No</td><td>Not Applicable</td><td>Not Applicable</td></tr><tr><td><strong>Performance</strong></td><td>Moderate-High</td><td>Moderate-Low</td><td>Highest</td><td>Lowest</td></tr><tr><td><strong>Security</strong></td><td>High</td><td>High</td><td>Lower than others since it doesn&#x27;t verify the state root</td><td>High</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fast-node">Fast Node<a class="hash-link" href="#fast-node" title="Direct link to heading">​</a></h3><p>For most applications, operating a fast node is advisable. This mode maintains only the current state, sans trie data, making it suitable for tasks such as querying the current state and processing transactions.</p><p>To activate the fast node, include <code>--allow-insecure-no-tries</code> in the <code>op-geth</code> startup command.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> ./geth --config ./config.toml --datadir ./node --syncmode full  --allow-insecure-no-tries</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To prune the MPT state (e.g., when transitioning from a full to a fast node), prune the node as follows:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./geth snapshot insecure-prune-all --datadir ./datadir ./genesis.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_S0QG"><p>Fast Node does not generate Trie Data when syncing.
Once the Fast Node is running, there is no way to switch back to Full Node.
Need to re-download snapshot data to restore it to Full Node.</p></div></div><p>For implementation details and further information, refer to <a href="https://github.com/bnb-chain/op-geth/pull/75" target="_blank" rel="noopener noreferrer">the PR</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="full-node">Full Node<a class="hash-link" href="#full-node" title="Direct link to heading">​</a></h3><p>Operating a full node is recommended if you require:</p><ul><li>Enhanced security and reliability assurances. The full node meticulously executes and locally verifies all blocks.</li><li>The facility to query trie data of the most recent 128 blocks, such as retrieving an account&#x27;s balance at a specific block height, simulating calls, and debugging traces.</li></ul><p>To enable the full node, set the <code>--syncmode full</code> flag in the <code>geth</code> command.</p><p>It is particularly advised to operate a full node with PBSS and pebble to minimize data redundancy and enhance performance.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--state.scheme path --db.engine pebble</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For comprehensive details, consult the <a href="/opbnb-docs/docs/tutorials/pbss-pebble/">PBSS document</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="archive-nodewith-op-reth">Archive Node(with op-reth)<a class="hash-link" href="#archive-nodewith-op-reth" title="Direct link to heading">​</a></h3><p>The Archive node mode archives the entirety of history trie data.
This mode is apt for scenarios necessitating access to the complete history trie data, such as block explorers and analytics.</p><p>The current volume of history trie data approximates 3TB (as of the end of April, 2024).
Significant performance issues may arise in the op-geth implementation when managing extensive history trie data.
Therefore, it is recommended to operate the archive node in conjunction with op-reth.</p><p>Below is an exemplary command for initiating the archive node with op-reth:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export L2_RPC=https://opbnb-mainnet-rpc.bnbchain.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">op-reth node \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --datadir /server/datadir \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --chain opbnb-mainnet \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --rollup.sequencer-http ${L2_RPC} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --authrpc.addr &quot;0.0.0.0&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --authrpc.port 8551 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --authrpc.jwtsecret /server/datadir/jwt.txt \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --http \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --http.addr &quot;0.0.0.0&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --http.port 8545 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --ws \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --ws.addr &quot;0.0.0.0&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --ws.port 8545 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --builder.gaslimit 150000000 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --nat any</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For further particulars, visit the <a href="https://github.com/bnb-chain/reth" target="_blank" rel="noopener noreferrer">op-reth GitHub repository</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="snapshots">Snapshots<a class="hash-link" href="#snapshots" title="Direct link to heading">​</a></h2><p>The latest snapshot data is accessible via the <a href="https://github.com/bnb-chain/opbnb-snapshot" target="_blank" rel="noopener noreferrer">opbnb-snapshot</a> repository.</p><p>Employing snapshot data can drastically curtail the time required for node synchronization.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-optimization">Performance Optimization<a class="hash-link" href="#performance-optimization" title="Direct link to heading">​</a></h2><p>In order to enhance the performance of <code>op-geth</code>, it is crucial to configure the cache settings appropriately. Allocating approximately one-third of the physical memory to the cache is advisable. For instance, if the system has 64GB of physical memory, the cache setting can be configured as:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--cache 20000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This allocation ensures that the cache is optimized for efficient use of system resources, ultimately leading to improved performance of <code>op-geth</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-server-as-a-daemon">Running Server as a Daemon<a class="hash-link" href="#running-server-as-a-daemon" title="Direct link to heading">​</a></h2><p>To ensure continuous operation, it is important to keep <code>op-node</code> and <code>op-geth</code> running at all times. One of the simplest and recommended solutions is to register them as systemd service. By doing so, they will automatically start upon system reboots and other relevant events, ensuring seamless operation without manual intervention.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="security">Security<a class="hash-link" href="#security" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="securing-your-full-node-rpc-from-hackers">Securing Your Full Node RPC from Hackers<a class="hash-link" href="#securing-your-full-node-rpc-from-hackers" title="Direct link to heading">​</a></h3><p>It is imperative to safeguard your Full Node RPC endpoints from unauthorized access. Exposing RPC endpoints to the public network can pose security risks, making it essential to restrict access and implement appropriate security measures to prevent unauthorized intrusion.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="software-vulnerabilities">Software Vulnerabilities<a class="hash-link" href="#software-vulnerabilities" title="Direct link to heading">​</a></h3><p>To ensure the security of your node and assets, it is crucial to download software only from official sources. Additionally, it is important to consistently update the software to the latest, most secure version available. By adhering to these practices, you can mitigate the risk of potential vulnerabilities and safeguard your node and assets from security threats.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a class="hash-link" href="#faq" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-does-my-node-experience-offline-status-or-block-height-lag-after-an-abrupt-termination">Why does my node experience offline status or block height lag after an abrupt termination?<a class="hash-link" href="#why-does-my-node-experience-offline-status-or-block-height-lag-after-an-abrupt-termination" title="Direct link to heading">​</a></h3><p>After running a synchronized node for an extended period of time, abruptly terminating the node(op-geth process) can result in a period of offline status upon restart. Specifically, only archived nodes are expected to quickly re-synchronize after such an event.</p><p>The reason for this behavior lies in the nature of Geth&#x27;s functionality. When Geth experiences a crash or is not shut down gracefully, the recent state that was held in memory is lost and must be regenerated. As a result, it can take Geth a considerable amount of time to restore these states.</p><p>The root cause of this prolonged restoration process can be attributed to the fact that Geth does flush the state trie periodically. The frequency of this flushing is defined by the trieTimeout parameter in the configuration file (config.toml). This periodic flushing is intended to maintain consistency and integrity within the node&#x27;s state, but it also contributes to the time required for state regeneration in the event of an abrupt shutdown.</p></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bnb-chain/opbnb-docs/blob/main/docs/tutorials/run-nodes-best-practices.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/opbnb-docs/docs/tutorials/running-a-local-development-environment/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Run Local Dev Environment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/opbnb-docs/docs/tutorials/running-a-local-node/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Run Local Mainnet or Testnet Node</div></a></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#selecting-the-appropriate-mode-and-storage-scheme" class="table-of-contents__link toc-highlight">Selecting the Appropriate Mode and Storage Scheme</a><ul><li><a href="#fast-node" class="table-of-contents__link toc-highlight">Fast Node</a></li><li><a href="#full-node" class="table-of-contents__link toc-highlight">Full Node</a></li><li><a href="#archive-nodewith-op-reth" class="table-of-contents__link toc-highlight">Archive Node(with op-reth)</a></li></ul></li><li><a href="#snapshots" class="table-of-contents__link toc-highlight">Snapshots</a></li><li><a href="#performance-optimization" class="table-of-contents__link toc-highlight">Performance Optimization</a></li><li><a href="#running-server-as-a-daemon" class="table-of-contents__link toc-highlight">Running Server as a Daemon</a></li><li><a href="#security" class="table-of-contents__link toc-highlight">Security</a><ul><li><a href="#securing-your-full-node-rpc-from-hackers" class="table-of-contents__link toc-highlight">Securing Your Full Node RPC from Hackers</a></li><li><a href="#software-vulnerabilities" class="table-of-contents__link toc-highlight">Software Vulnerabilities</a></li></ul></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a><ul><li><a href="#why-does-my-node-experience-offline-status-or-block-height-lag-after-an-abrupt-termination" class="table-of-contents__link toc-highlight">Why does my node experience offline status or block height lag after an abrupt termination?</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/opbnb-docs/assets/js/runtime~main.0eccf838.js"></script>
<script src="/opbnb-docs/assets/js/main.1bd97818.js"></script>
</body>
</html>